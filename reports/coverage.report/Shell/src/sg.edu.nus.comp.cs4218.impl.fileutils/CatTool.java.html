<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>CatTool.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Shell (1) (Mar 17, 2014 12:17:28 AM)</a> &gt; <a href="../../index.html" class="el_group">Shell</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">sg.edu.nus.comp.cs4218.impl.fileutils</a> &gt; <span class="el_source">CatTool.java</span></div><h1>CatTool.java</h1><pre class="source lang-java linenums">package sg.edu.nus.comp.cs4218.impl.fileutils;

import sg.edu.nus.comp.cs4218.fileutils.ICatTool;
import sg.edu.nus.comp.cs4218.impl.ATool;

import java.io.*;
import java.nio.charset.StandardCharsets;

public class CatTool extends ATool implements ICatTool {
    /**
     * Constructor
     *
     * @param arguments Arguments the tool is going to be executed with.
     */
    public CatTool(String[] arguments) {
<span class="fc" id="L16">        super(arguments);</span>
<span class="fc" id="L17">    }</span>

    @Override
    public String getStringForFile(File toRead) {
<span class="fc" id="L21">    	statusError();</span>
    	
<span class="fc bfc" id="L23" title="All 2 branches covered.">        if (toRead == null) {</span>
<span class="fc" id="L24">            return null;</span>
        }
<span class="pc bpc" id="L26" title="1 of 6 branches missed.">        if (toRead.exists() &amp;&amp; toRead.isFile() &amp;&amp; toRead.canRead()) {</span>
            try {
<span class="fc" id="L28">                FileInputStream fis = new FileInputStream(toRead);</span>
<span class="fc" id="L29">                ByteArrayOutputStream baos = new ByteArrayOutputStream();</span>
                
                int ch;
<span class="fc bfc" id="L32" title="All 2 branches covered.">                while ((ch = fis.read()) != -1) {</span>
<span class="fc" id="L33">                    baos.write(ch);</span>
                }
<span class="fc" id="L35">                fis.close();</span>
<span class="fc" id="L36">                byte[] file = baos.toByteArray();</span>
                
<span class="fc" id="L38">                statusSuccess();</span>
<span class="fc" id="L39">                return new String(file, StandardCharsets.UTF_8);</span>
<span class="nc" id="L40">            } catch (FileNotFoundException e) {</span>
<span class="nc" id="L41">                return null;</span>
<span class="nc" id="L42">            } catch (IOException e) {</span>
<span class="nc" id="L43">                return null;</span>
            }
        } else {
<span class="fc" id="L46">            return null;</span>
        }
    }

    /**
     * Executes the tool with args provided in the constructor
     *
     * @param workingDir
     * @param stdin      Input on stdin. NOT THE ARGUMENTS! Can be null.
     * @return Output on stdout
     */
    @Override
    public String execute(File workingDir, String stdin) {
<span class="fc" id="L59">        int argLength = this.args.length;</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">        if (argLength == 0) {</span>
<span class="fc" id="L61">        	statusSuccess();</span>
<span class="fc" id="L62">            return stdin;</span>
        }

<span class="fc" id="L65">        boolean isFirstStdin = true;</span>

<span class="fc" id="L67">        StringBuilder sb = new StringBuilder();</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">        for (String arg : this.args) {</span>
<span class="pc bpc" id="L69" title="1 of 2 branches missed.">            if (Thread.interrupted()) {</span>
<span class="nc" id="L70">                statusSuccess();</span>
<span class="nc" id="L71">                return sb.toString();</span>
            }
            
<span class="fc bfc" id="L74" title="All 2 branches covered.">            if(arg.equals(&quot;-&quot;)){</span>
                // Process only first stdin argument
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">                if (isFirstStdin) {</span>
<span class="fc" id="L77">                    isFirstStdin = false;</span>
<span class="fc" id="L78">                    sb.append(stdin);</span>
                }
<span class="fc" id="L80">            }else{</span>
<span class="fc" id="L81">            	String result = getStringForFile(workingDir.toPath().resolve(arg).toFile());</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">            	if (result == null) {</span>
<span class="fc" id="L83">            		statusError();</span>
<span class="fc" id="L84">            		sb.append(String.format(&quot;Error: Could not read file: %s%n&quot;, arg));</span>
<span class="fc" id="L85">            		return sb.toString();</span>
            	}
<span class="fc" id="L87">            	sb.append(result);</span>
            }
        }
<span class="fc" id="L90">        return sb.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span>Shell (1) (Mar 17, 2014 12:17:28 AM)</div></body></html>