<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>CommTool.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Shell (1) (Mar 17, 2014 12:17:28 AM)</a> &gt; <a href="../../index.html" class="el_group">Shell</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">sg.edu.nus.comp.cs4218.impl.extended2</a> &gt; <span class="el_source">CommTool.java</span></div><h1>CommTool.java</h1><pre class="source lang-java linenums">package sg.edu.nus.comp.cs4218.impl.extended2;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.InvalidPathException;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.Arrays;

import sg.edu.nus.comp.cs4218.extended2.ICommTool;
import sg.edu.nus.comp.cs4218.impl.ATool;

public class CommTool extends ATool implements ICommTool {
	private final static int BUF_SIZE = 4096;
	private final static int CHECK_DEFAULT = 0;
	private final static int CHECK_ORDER = 1;
	private final static int NOCHECK_ORDER= 2;
	
	
	public CommTool(String[] arguments) {
<span class="fc" id="L24">		super(arguments);</span>
<span class="fc" id="L25">	}</span>

	@Override
	public String execute(File workingDir, String stdin) {
<span class="fc" id="L29">		statusError();</span>
		
<span class="fc" id="L31">		boolean isCheckOrder = false;</span>
<span class="fc" id="L32">		boolean isNoCheckOrder = false;</span>

<span class="fc" id="L34">		String fileName1 = null, fileName2 = null;</span>
		
<span class="fc bfc" id="L36" title="All 2 branches covered.">		for (String arg : args) {</span>
<span class="fc bfc" id="L37" title="All 2 branches covered.">			if (arg.equals(&quot;-c&quot;)) {</span>
<span class="fc bfc" id="L38" title="All 2 branches covered.">				if (!isNoCheckOrder) {</span>
<span class="fc" id="L39">					isCheckOrder = true;</span>
				}
<span class="fc" id="L41">			}</span>
<span class="fc bfc" id="L42" title="All 2 branches covered.">			else if (arg.equals(&quot;-d&quot;)) {</span>
<span class="pc bpc" id="L43" title="1 of 2 branches missed.">				if (!isCheckOrder) {</span>
<span class="fc" id="L44">					isNoCheckOrder = true;</span>
				}
<span class="fc" id="L46">			}</span>
<span class="fc bfc" id="L47" title="All 2 branches covered.">			else if (arg.equals(&quot;-help&quot;)) {</span>
<span class="fc" id="L48">				return getHelp();</span>
			}
			else {	// must be file name
<span class="fc bfc" id="L51" title="All 2 branches covered.">				if (fileName1 == null) {</span>
<span class="fc" id="L52">					fileName1 = arg;</span>
<span class="fc" id="L53">				}</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">				else if (fileName2 == null) {</span>
<span class="fc" id="L55">					fileName2 = arg;</span>
<span class="fc" id="L56">				}</span>
				else {	// extra non-recognizable arg, return err
<span class="fc" id="L58">					return &quot;Error: comm: unrecognized option '&quot;+arg+&quot;'\nTry 'comm -help' for more information.&quot; + System.lineSeparator();</span>
				}
			}
		}
		
		
		File file1, file2;
<span class="fc" id="L65">		Path path1 = null, path2 = null;</span>
		String fileContent1, fileContent2;
		
		try {
<span class="fc" id="L69">			path1 = workingDir.toPath().resolve(fileName1);</span>
<span class="fc" id="L70">			path2 = workingDir.toPath().resolve(fileName2);</span>
<span class="fc" id="L71">			file1 = path1.toFile();</span>
<span class="fc" id="L72">            fileContent1 = readContentsOfFile(file1);</span>
<span class="fc" id="L73">            file2 = path2.toFile();</span>
<span class="fc" id="L74">            fileContent2 = readContentsOfFile(file2);</span>

<span class="fc bfc" id="L76" title="All 4 branches covered.">    		if (!isCheckOrder &amp;&amp; !isNoCheckOrder) {</span>
<span class="fc" id="L77">    			return compareFiles(fileContent1, fileContent2);</span>
    		}
<span class="fc bfc" id="L79" title="All 2 branches covered.">    		else if (isCheckOrder) {</span>
<span class="fc" id="L80">    			return compareFilesCheckSortStatus(fileContent1, fileContent2);</span>
    		}
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">    		else if (isNoCheckOrder) {</span>
<span class="fc" id="L83">    			return compareFilesDoNotCheckSortStatus(fileContent1, fileContent2);</span>
    		}
    		else {	// should be unreachable
<span class="nc" id="L86">    			return &quot;Invalid arguments. -d and -c flags cannot be both present&quot; + System.lineSeparator();</span>
    		}
		}
<span class="nc" id="L89">		catch (InvalidPathException e) {</span>
<span class="nc" id="L90">			return &quot;File invalid.&quot; + System.lineSeparator();</span>
		}
<span class="nc" id="L92">        catch (FileNotFoundException ex) {</span>
<span class="nc" id="L93">            return &quot;File not found.&quot; + System.lineSeparator();</span>
        } 
<span class="nc" id="L95">        catch (IOException e) {</span>
<span class="nc" id="L96">            return &quot;An error occurred processing this path.&quot; + System.lineSeparator();</span>
        }
<span class="fc" id="L98">		catch (Exception e) {</span>
<span class="fc" id="L99">			return &quot;An &quot;+ e +&quot; error has occured&quot;;</span>
		}
        
		
	}

	@Override
	public String compareFiles(String input1, String input2) {
		
<span class="fc" id="L108">		return compareFilesHelper(input1, input2, CHECK_DEFAULT);</span>
	}

	@Override
	public String compareFilesCheckSortStatus(String input1, String input2) {
		
<span class="fc" id="L114">		return compareFilesHelper(input1, input2, CHECK_ORDER);</span>
	}

	@Override
	public String compareFilesDoNotCheckSortStatus(String input1, String input2) {
		
<span class="fc" id="L120">		return compareFilesHelper(input1, input2, NOCHECK_ORDER);</span>
	}

	private String compareFilesHelper(String input1, String input2, int type) {
<span class="pc bpc" id="L124" title="1 of 4 branches missed.">		if (input1 == null || input2 == null) {</span>
<span class="fc" id="L125">			return &quot;Internal NullPointerError.\n&quot;;</span>
		}
<span class="fc bfc" id="L127" title="All 4 branches covered.">		if (input1.equals(&quot;&quot;) &amp;&amp; input2.equals(&quot;&quot;)) {</span>
<span class="fc" id="L128">			return &quot;&quot;;</span>
		}
<span class="fc" id="L130">		boolean isFile1UnsortedFlagged = false;</span>
<span class="fc" id="L131">		boolean isFile2UnsortedFlagged = false;</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">		if (type == NOCHECK_ORDER) {</span>
<span class="fc" id="L133">			isFile1UnsortedFlagged = true;</span>
<span class="fc" id="L134">			isFile2UnsortedFlagged = true;</span>
		}
<span class="fc" id="L136">		ArrayList&lt;String&gt; col = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L137">		String res = &quot;&quot;;</span>
<span class="fc" id="L138">		input1.replaceAll(&quot;\r\n&quot;, &quot;\n&quot;);</span>
<span class="fc" id="L139">		input2.replaceAll(&quot;\r\n&quot;, &quot;\n&quot;);</span>
		
<span class="fc" id="L141">		String[] inArr1 = null, inArr2 = null;</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">		if (input1.equals(&quot;&quot;)) {</span>
<span class="fc" id="L143">			inArr1 = new String[0];</span>
<span class="fc" id="L144">		}</span>
		else {
<span class="fc" id="L146">			inArr1 = input1.split(&quot;\n&quot;);</span>
		}
<span class="fc bfc" id="L148" title="All 2 branches covered.">		if (input2.equals(&quot;&quot;)) {</span>
<span class="fc" id="L149">			inArr2 = new String[0];</span>
<span class="fc" id="L150">		}</span>
		else {
<span class="fc" id="L152">			inArr2 = input2.split(&quot;\n&quot;);</span>
		}
		
		
<span class="fc" id="L156">		int idx1 = 0, idx2 = 0;</span>
<span class="fc" id="L157">		while (true) {</span>
			
<span class="fc bfc" id="L159" title="All 4 branches covered.">			if (idx1 &gt;= inArr1.length &amp;&amp; idx2 &gt;= inArr2.length) {</span>
<span class="fc" id="L160">				break;</span>
			}
<span class="fc bfc" id="L162" title="All 2 branches covered.">			else if (idx1 &gt;= inArr1.length) {</span>

				
<span class="fc bfc" id="L165" title="All 2 branches covered.">				if (idx2 != 0) {</span>
<span class="fc bfc" id="L166" title="All 4 branches covered.">					if (! (inArr2[idx2].compareTo(inArr2[idx2 - 1]) &gt;= 0) &amp;&amp; !isFile2UnsortedFlagged) {</span>
<span class="fc" id="L167">						isFile2UnsortedFlagged = true;</span>
<span class="pc bpc" id="L168" title="1 of 3 branches missed.">						switch(type) {</span>
						case CHECK_DEFAULT:
<span class="fc" id="L170">							col.add(&quot;comm: file 2 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc" id="L171">							break;</span>
						case CHECK_ORDER:
<span class="fc" id="L173">							col.add(&quot;comm: file 2 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc bfc" id="L174" title="All 2 branches covered.">							for (String str : col) {</span>
<span class="fc" id="L175">								res += str;</span>
							}
<span class="fc" id="L177">							return res;</span>
						case NOCHECK_ORDER:
						default: 
							
						}
					}
				}
<span class="fc" id="L184">				col.add(&quot;\t\t&quot;+ inArr2[idx2] +&quot;\n&quot;);</span>
<span class="fc" id="L185">				idx2++;</span>
<span class="fc" id="L186">				continue;</span>
			}
<span class="fc bfc" id="L188" title="All 2 branches covered.">			else if (idx2 &gt;= inArr2.length) {</span>
				
<span class="fc bfc" id="L190" title="All 2 branches covered.">				if (idx1 != 0) {</span>
<span class="fc bfc" id="L191" title="All 4 branches covered.">					if (!(inArr1[idx1].compareTo(inArr1[idx1 - 1]) &gt;= 0) &amp;&amp; !isFile1UnsortedFlagged) {</span>
<span class="fc" id="L192">						isFile1UnsortedFlagged = true;</span>
<span class="pc bpc" id="L193" title="2 of 3 branches missed.">						switch (type) {</span>
						case CHECK_DEFAULT:
<span class="fc" id="L195">							col.add(&quot;comm: file 1 is not in sorted order&quot;</span>
									+ &quot;\n&quot;);
<span class="fc" id="L197">							break;</span>
						case CHECK_ORDER:
<span class="nc" id="L199">							col.add(&quot;comm: file 1 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">							for (String str : col) {</span>
<span class="nc" id="L201">								res += str;</span>
							}
<span class="nc" id="L203">							return res;</span>
						case NOCHECK_ORDER:
						default:
						}
					}
				}
<span class="fc" id="L209">				col.add(inArr1[idx1] + &quot;\n&quot;);</span>
<span class="fc" id="L210">				idx1++;</span>
<span class="fc" id="L211">				continue;</span>
			}
			
<span class="fc bfc" id="L214" title="All 2 branches covered.">			if (inArr1[idx1].compareTo(inArr2[idx2]) == 0) {</span>
				
<span class="fc bfc" id="L216" title="All 2 branches covered.">				if (idx1 != 0) {</span>
<span class="fc bfc" id="L217" title="All 4 branches covered.">					if (! (inArr1[idx1].compareTo(inArr1[idx1 - 1]) &gt;= 0)  &amp;&amp; !isFile1UnsortedFlagged) {</span>
<span class="fc" id="L218">						isFile1UnsortedFlagged = true;</span>
<span class="pc bpc" id="L219" title="1 of 3 branches missed.">						switch(type) {</span>
							case CHECK_DEFAULT:
<span class="fc" id="L221">								col.add(&quot;comm: file 1 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc" id="L222">								break;</span>
							case CHECK_ORDER:
<span class="fc" id="L224">								col.add(&quot;comm: file 1 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">								for (String str : col) {</span>
<span class="fc" id="L226">									res += str;</span>
								}
<span class="fc" id="L228">								return res;</span>
							case NOCHECK_ORDER:
							default: 
								
						}
					}
				}
				
<span class="fc bfc" id="L236" title="All 2 branches covered.">				if (idx2 != 0) {</span>
<span class="fc bfc" id="L237" title="All 4 branches covered.">					if (! (inArr2[idx2].compareTo(inArr2[idx2 - 1]) &gt;= 0)  &amp;&amp; !isFile2UnsortedFlagged) {</span>
<span class="fc" id="L238">						isFile2UnsortedFlagged = true;</span>
<span class="pc bpc" id="L239" title="2 of 3 branches missed.">						switch(type) {</span>
						case CHECK_DEFAULT:
<span class="fc" id="L241">							col.add(&quot;comm: file 2 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc" id="L242">							break;</span>
						case CHECK_ORDER:
<span class="nc" id="L244">							col.add(&quot;comm: file 2 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">							for (String str : col) {</span>
<span class="nc" id="L246">								res += str;</span>
							}
<span class="nc" id="L248">							return res;</span>
						case NOCHECK_ORDER:
						default: 
							
						}
					}
				}
<span class="fc" id="L255">				col.add(&quot;\t\t\t\t&quot; + inArr1[idx1] + &quot;\n&quot;);</span>
<span class="fc" id="L256">				idx1++;</span>
<span class="fc" id="L257">				idx2++;</span>
<span class="fc" id="L258">			}</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">			else if (inArr1[idx1].compareTo(inArr2[idx2]) &lt; 0) {</span>
				
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">				if (idx1 != 0) {</span>
<span class="nc bnc" id="L262" title="All 4 branches missed.">					if (!(inArr1[idx1].compareTo(inArr1[idx1 - 1]) &gt;= 0) &amp;&amp; !isFile1UnsortedFlagged) {</span>
<span class="nc" id="L263">						isFile1UnsortedFlagged = true;</span>
<span class="nc bnc" id="L264" title="All 3 branches missed.">						switch (type) {</span>
						case CHECK_DEFAULT:
<span class="nc" id="L266">							col.add(&quot;comm: file 1 is not in sorted order&quot;</span>
									+ &quot;\n&quot;);
<span class="nc" id="L268">							break;</span>
						case CHECK_ORDER:
<span class="nc" id="L270">							col.add(&quot;comm: file 1 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">							for (String str : col) {</span>
<span class="nc" id="L272">								res += str;</span>
							}
<span class="nc" id="L274">							return res;</span>
						case NOCHECK_ORDER:
						default:
						}
					}
				}
<span class="fc" id="L280">				col.add(inArr1[idx1] + &quot;\n&quot;);</span>
<span class="fc" id="L281">				idx1++;</span>
				
<span class="fc" id="L283">			}</span>
			else {
				
<span class="fc bfc" id="L286" title="All 2 branches covered.">				if (idx2 != 0) {</span>
<span class="fc bfc" id="L287" title="All 4 branches covered.">					if (! (inArr2[idx2].compareTo(inArr2[idx2 - 1]) &gt;= 0)  &amp;&amp; !isFile2UnsortedFlagged) {</span>
<span class="fc" id="L288">						isFile2UnsortedFlagged = true;</span>
<span class="pc bpc" id="L289" title="1 of 3 branches missed.">						switch(type) {</span>
						case CHECK_DEFAULT:
<span class="fc" id="L291">							col.add(&quot;comm: file 2 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc" id="L292">							break;</span>
						case CHECK_ORDER:
<span class="fc" id="L294">							col.add(&quot;comm: file 2 is not in sorted order&quot; + &quot;\n&quot;);</span>
<span class="fc bfc" id="L295" title="All 2 branches covered.">							for (String str : col) {</span>
<span class="fc" id="L296">								res += str;</span>
							}
<span class="fc" id="L298">							return res;</span>
						case NOCHECK_ORDER:
						default: 
							
						}
					}
				}
<span class="fc" id="L305">				col.add(&quot;\t\t&quot;+ inArr2[idx2] +&quot;\n&quot;);</span>
<span class="fc" id="L306">				idx2++;</span>
			}
		}
		
<span class="fc bfc" id="L310" title="All 2 branches covered.">		for (String str : col) {</span>
<span class="fc" id="L311">			res += str;</span>
		}
<span class="fc" id="L313">		return res;</span>
	}
	
    private String readContentsOfFile(File file) throws IOException, FileNotFoundException, NullPointerException {
        FileInputStream is;
<span class="fc" id="L318">       	is = new FileInputStream(file);</span>

<span class="fc" id="L320">        StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L321">        byte buf[] = new byte[BUF_SIZE];</span>
<span class="fc" id="L322">        int read = 0;</span>
<span class="fc bfc" id="L323" title="All 2 branches covered.">        while ((read = is.read(buf)) != -1) {</span>
<span class="fc" id="L324">            sb.append(new String(Arrays.copyOf(buf, read), StandardCharsets.UTF_8));</span>
        }
<span class="fc" id="L326">        is.close();</span>
<span class="fc" id="L327">        return sb.toString();</span>
    }
	
	@Override
	public String getHelp() {

<span class="fc" id="L333">		return &quot;comm : Compares two sorted files line by line. With no options, produce three-column output. Column one\n&quot;</span>
				+ &quot;contains lines unique to FILE1, column two contains lines unique to FILE2, and column three contains lines\n&quot;
				+ &quot;common to both files.\n\n&quot;
				+ &quot;Command Format - comm [OPTIONS] FILE1 FILE2\n&quot;
				+ &quot;FILE1 - Name of the file 1\n&quot;
				+ &quot;FILE2 - Name of the file 2\n&quot;
				+ &quot;-c : check that the input is correctly sorted, even if all input lines are pairable\n&quot;
				+ &quot;-d : do not check that the input is correctly sorted\n&quot;
				+ &quot;-help : Brief information about supported options\n&quot;;

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span>Shell (1) (Mar 17, 2014 12:17:28 AM)</div></body></html>